import {NextFunction, Request, Response} from "express";

export const isAuthorized = (opts: {
    hasRole: Array<"Teacher" | "Student">,
    allowSameUser?: boolean
}) => {
  return (req: Request, res: Response, next: NextFunction) => {
    const {role, uid} = res.locals;
    if (role === "Teacher") {
      return next();
    }
    const {id} = req.params;

    if (opts.allowSameUser && uid && id === id) {
      return next();
    }

    if (!role) {
      return res.status(403).send();
    }

    if (opts.hasRole.includes(role)) {
      return next();
    }

    return res.status(403).json({message: "Fordidden"});
  };
};
